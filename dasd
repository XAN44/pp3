'use client'

import { Button, Input } from '@nextui-org/react'
import Link from 'next/link'
import React, { useEffect, useState } from 'react'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog'

export default function SearchBar() {
  const [query, setQuery] = React.useState('')
  const [searchResult, setSearchResult] = React.useState<any[]>([])

  useEffect(() => {
    const fetchSearchResult = async () => {
      if (query.trim() !== '') {
        const response = await fetch('/api/search?q=' + query)
        const json = await response.json()
        setSearchResult(json)
      } else {
        setSearchResult([])
      }
    }
    fetchSearchResult()
  }, [query])

  const handleSubmit = (event: React.FormEvent<HTMLFormElement>) => {
    event.preventDefault()
    setQuery(event.currentTarget.q.value)
  }

  return (
    <>
      <Dialog>
        <DialogTrigger>Search</DialogTrigger>
        <DialogContent>
          <DialogHeader>
            <DialogTitle> Example Search </DialogTitle>
            <DialogDescription>
              <div>
                <form onSubmit={handleSubmit} className="py-4">
                  <Input
                    variant="underlined"
                    size="md"
                    color="secondary"
                    type="text"
                    name="q"
                    placeholder="ค้นหา"
                    onChange={(event) => setQuery(event.target.value)}
                  />
                  <Button type="submit">Search</Button>
                  {searchResult.map((article) => (
                    <div className="" key={article}>
                      <Link href={`/article/${article.id}`}>
                        <div className="">{article.title}</div>
                      </Link>
                    </div>
                  ))}
                </form>
              </div>
            </DialogDescription>
          </DialogHeader>
        </DialogContent>
      </Dialog>
    </>
  )
}
